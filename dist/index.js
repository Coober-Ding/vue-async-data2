!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("vue")):"function"==typeof define&&define.amd?define(["vue"],e):t.AsyncDataMixin=e(t.Vue)}(this,function(t){"use strict";function i(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function c(t){return null!==t&&"function"==typeof t}function s(t){return null!=t}t=t&&t.hasOwnProperty("default")?t.default:t;var u=function(){function n(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.vm=t,this.options=e,this._asyncDataCtrl={hasWaitQue:!1,suspend:!1,queue:[]}}var t,e,a;return t=n,(e=[{key:"init",value:function(){var n=this,a=this.vm,i=this.options;Object.keys(i).forEach(function(e){var t=i[e];c(t.init)&&n.initVar(e,t.init),s(t.watch)&&t.watch.forEach(function(t){a.$watch(t,function(){n.fetchVar(e)})})})}},{key:"initVar",value:function(t,e){var n=this.vm;s(n[t])?n[t]=e():n.$set(n,t,e())}},{key:"addToQueue",value:function(t){var e=this,n=this.vm,a=this._asyncDataCtrl.queue;-1==a.indexOf(t)&&a.push(t),this._asyncDataCtrl.suspend||this._asyncDataCtrl.hasWaitQue||(n.$nextTick(function(){e._asyncDataCtrl.hasWaitQue=!1,e._asyncDataCtrl.suspend||e.executeQueue()}),this._asyncDataCtrl.hasWaitQue=!0)}},{key:"executeQueue",value:function(){var i=this.vm,s=this.options,t=this._asyncDataCtrl.queue;if(0!=t.length){var e=t.slice(0);t.length=0,e.forEach(function(e){var t=s[e],n=t.fetch.call(i),a=t.error;n.then(function(t){i[e]=t},function(t){c(a)?a.call(i,t):window.console.warn("you got a error when fecth asyncData[".concat(e,"] from remote"))})})}}},{key:"fetchVar",value:function(t){this.addToQueue(t)}},{key:"fetchData",value:function(){var e=this;Object.keys(this.options).forEach(function(t){e.fetchVar(t)})}},{key:"fetch",value:function(t){this.fetchVar(t)}},{key:"suspend",value:function(){this._asyncDataCtrl.suspend=!0}},{key:"resume",value:function(){this._asyncDataCtrl.suspend=!1,this._asyncDataCtrl.hasWaitQue||this.executeQueue()}},{key:"clean",value:function(){this._asyncDataCtrl.queue.length=0}}])&&i(t.prototype,e),a&&i(t,a),n}();function e(t,e){if(a=!0,Object.keys(n=e).forEach(function(t){var e=n[t];s(e)&&c(e.fetch)&&c(e.init)||(a=!1)}),!a)throw Error("async_data.err.options_volidate_fail");var n,a;return new u(t,e)}var n={beforeCreate:function(){var t,e,n,a,i=this.$options.asyncData;s(i)&&0<Object.keys(i).length&&(t=this,e=Object.keys(i),n=t.$options.data,a={},t.$options.data=function(){return e.forEach(function(t){a[t]=null}),Object.assign(n(),a)})},created:function(){var t=this.$options.asyncData;s(t)&&0<Object.keys(t).length&&(this.$async=e(this,t),this.$async.init())},activated:function(){s(this.$async)&&this.$async.fetchData()},mounted:function(){s(this.$async)&&this.$async.fetchData()}},a=t.config.optionMergeStrategies;return a.asyncData=a.methods,n});
